
function sendRequest(requestDataType,assets)
{if(requestDataType===undefined)
{requestDataType="json";}
if(assets===undefined)
{assets=null;}
$.ajax({dataType:requestDataType,data:$('form.cpage input, form.cpage select, form.cpage textarea').serialize(),cache:false,timeout:30000,method:"post",headers:{'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')},beforeSend:function(){$('form.cpage input[name="ccusr_nd"]').val(Date.now());},success:function(response){if(response.redirect===undefined)
{if(requestDataType=="html")
{$('body#comproso').html(response);$(document).triggerHandler("updated");}
if(requestDataType=="json")
{$('form.cpage input[name="ccfg_tmlt"]').val(response.time_limit);$('form.cpage input[name="ccfg_tvl"]').val(response.interval);$('form.cpage input[name="ccusr_rnd"]').val(response.round);$('form.cpage input[name="ccusr_ctns"]').val(JSON.stringify([]));$.each(response.results,function(name,result){if(result.results.accessors!==undefined)
{element=$('body#comproso form.cpage *[name="'+result.name+'"]');$.each(result.results.accessors,function(index,accessor){if(element.attr("data-"+accessor)!==undefined)
{arr=element.data(accessor);arr.push(result.results[accessor]);element.data(accessor,arr);}
element.attr(accessor,result.results[accessor]);});element.triggerHandler("updated");}});}
$(document).triggerHandler('ajaxProceeded');}
else
{$('meta[name="csrf-token"]').attr('content',response.token);if(response.assets!==null)
{$.ajaxSetup({cache:true});$.each(response.assets,function(key,asset){$.getScript(asset);});}
sendRequest("html");}},complete:function(){$('form.cpage input[name="ccusr_tstrt"]').val(Date.now());},done:function(){$('form.cpage input[name="ccusr_rt"]').val((Date.now()-$('form.cpage input[name="ccusr_nd"]').val()));},error:function(xhr,status,errorThrown){console.log("Error: "+errorThrown);console.log("Status: "+status);console.dir(xhr);document.write(xhr.responseText);}});}
function storeProcessData(element){if((element===undefined)&&(!$(this).attr('name')))
return;actions=JSON.parse($('form.cpage input[name="ccusr_ctns"]').val());newactions={};if(element===undefined)
{newactions.item=$(this).attr('name');newactions.value=$(this).attr('value');}
else
{newactions.item="reset";newactions.value=true;}
newactions.tstmp=Date.now();actions.push(newactions);$('form.cpage input[name="ccusr_ctns"]').val(JSON.stringify(actions));}
$(document).on("ajaxProceeded",function(){if($('form.cpage .cnav').length===0)
{if($('form.cpage input[name="ccfg_tvl"]').val()>0)
{var tvlId=setTimeout(sendRequest,($('form.cpage input[name="ccfg_tvl"]').val()*1000));}}});$(document).on("updated",function(){if(typeof tlmtId!=='undefined')
{clearTimeout(tlmtId);}
if(typeof tvlId!=='undefined')
{clearTimeout(tvlId);}
if($('form.cpage input[name="ccfg_tlmt"]').val()>0)
{var tlmtId=setTimeout(sendRequest,($('form.cpage input[name="ccfg_tlmt"]').val()*1000));}
$('form.cpage .cnav input[type="button"]').click(function(){if($(this).hasClass('rst'))
{$('form.cpage').trigger('reset');}
else
{if($(this).hasClass('bwd'))
{$('form.cpage input[name="cctrl_prvs"]').val(1);}
else
{$('form.cpage input[name="cctrl_prvs"]').val(0);}
$('form.cpage input[name="ccusr_nd"]').val(Date.now());sendRequest();}});$('form.cpage *:not(.notrace) *[name^="item"]:not(.notrace)').change(storeProcessData());});